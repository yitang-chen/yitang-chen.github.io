<!DOCTYPE html>
<html>
<head>
  <!-- TapPay TPDirect JS SDK -->
  <script src="https://pay.google.com/gp/p/js/pay.js"></script>
  <script src="https://js.tappaysdk.com/sdk/tpdirect/v5.19.1"></script>
<!-- <script>
  function triggerGooglePay() {
    TPDirect.setupSDK(
      11327,
      'app_whdEWBH8e8Lzy4N6BysVRRMILYORF6UxXbiOFsICkz0J9j1C0JUlCHv1tVJC',
      'sandbox'
    );

    const googlePaySetting = {
      googleMerchantId: "Come from google portal",
      tappayGoogleMerchantId: "Come from tappay portal",
      allowedCardAuthMethods: ["PAN_ONLY", "CRYPTOGRAM_3DS"],
      merchantName: "TapPay Test!",
      emailRequired: true,
      shippingAddressRequired: true,
      billingAddressRequired: true,
      billingAddressFormat: "MIN",
      allowPrepaidCards: true,
      allowedCountryCodes: ['TW'],
      phoneNumberRequired: true
    };
    TPDirect.googlePay.setupGooglePay(googlePaySetting);

    const paymentRequest = {
      allowedNetworks: ["AMEX", "JCB", "MASTERCARD", "VISA"],
      price: "123",
      currency: "TWD"
    };

    TPDirect.googlePay.setupPaymentRequest(paymentRequest, function (err, result) {
      console.log("Google Pay check err:", err);
      console.log("Google Pay check result:", result);
      if (result.canUseGooglePay) {
        TPDirect.googlePay.setupGooglePayButton({
          el: document.createElement('div'), // 不插入 UI
          color: "black",
          type: "long",
          getPrimeCallback: function (err, prime) {
            console.log("Prime:", prime);
            alert("Prime: " + prime);
          }
        }).click(); // 直接觸發 click
      } else {
        alert("Google Pay not available");
      }
    });
  }
</script> -->

<script>
  (function () {
    window.triggerGooglePay = function () {
      console.log('[GPay] trigger called');

      TPDirect.setupSDK(
        11327,
        'app_whdEWBH8e8Lzy4N6BysVRRMILYORF6UxXbiOFsICkz0J9j1C0JUlCHv1tVJC',
        'sandbox'
      );

      const googlePaySetting = {
        googleMerchantId: "Come from google portal",
        tappayGoogleMerchantId: "Come from tappay portal",
        allowedCardAuthMethods: ["PAN_ONLY", "CRYPTOGRAM_3DS"],
        merchantName: "TapPay Test!",
        emailRequired: true,
        shippingAddressRequired: true,
        billingAddressRequired: true,
        billingAddressFormat: "MIN",
        allowPrepaidCards: true,
        allowedCountryCodes: ['TW'],
        phoneNumberRequired: true
      };
      TPDirect.googlePay.setupGooglePay(googlePaySetting);

      const paymentRequest = {
        allowedNetworks: ["AMEX", "JCB", "MASTERCARD", "VISA"],
        price: "123",
        currency: "TWD"
      };

      TPDirect.googlePay.setupPaymentRequest(paymentRequest, function (err, result) {
        console.log("[GPay] setupPaymentRequest -> err:", err);
        console.log("[GPay] setupPaymentRequest -> result:", result);

        if (result && result.canUseGooglePay) {
          console.log("[GPay] canUseGooglePay = true, calling getPrime...");

          TPDirect.googlePay.getPrime(function (err, prime, payload) {
            console.log("[GPay] getPrime err:", err);
            console.log("[GPay] getPrime prime:", prime);
            console.log("[GPay] getPrime payload:", payload);

            if (err) {
              alert("getPrime error: " + JSON.stringify(err));
              return;
            }
            alert("Prime: " + prime);
          });
        } else {
          alert("Google Pay not available");
        }
      });
    };
  })();
</script>

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="A new Flutter project.">

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="tap_pay_poc">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>tap_pay_poc</title>
  <link rel="manifest" href="manifest.json">
</head>
<body>
  <script src="flutter_bootstrap.js" async></script>
</body>
</html>
